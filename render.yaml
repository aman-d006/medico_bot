services:
  - type: web
    name: medical-assistant
    runtime: python
    region: oregon
    plan: free
    buildCommand: |
      echo "=== STEP 1: Force Python 3.11.9 ==="
      # Method A: Use pyenv (Render's standard tool)
      pyenv install -s 3.11.9
      pyenv global 3.11.9
      
      # Method B: Also set PYENV_VERSION environment variable as a fallback
      export PYENV_VERSION=3.11.9
      
      # Verify the active Python version
      echo "Active Python version:"
      python --version
      which python
      
      echo "=== STEP 2: Upgrade core build tools in the CORRECT Python ==="
      # Use the full path to ensure we're using the right one
      /opt/render/project/src/.pyenv/shims/python -m pip install --upgrade pip setuptools wheel
      
      echo "=== STEP 3: Install project dependencies ==="
      pip install -r server/requirements.txt
      
      echo "=== STEP 4: Final verification ==="
      python -c "import setuptools; print('setuptools OK')"
    startCommand: cd server && uvicorn main:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.9
      - key: PIP_DEFAULT_TIMEOUT
        value: "100"